<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forms Submitted</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link href="/css/style.css" rel="stylesheet">
</head>

<body onload="populateTable()">

    <div class="wrapper-submit">
        <div class="container-lg container-color">
            <h2 class="container-text">View Forms You Have Submitted</h2>

            <table id="myTable" class="table table-bordered table-striped table-hover" style="width: 100%;">
                <tr>
                    <td>Event Type</td>
                    <td>Date Submitted</td>
                    <td>Status</td>
                </tr>
            </table>


            <div>
                <!-- if a supervisor, add extra button-->
                <button id="back-button">Back</button>
            </div>

            </button>
        </div>

    </div>

</body>
<script>

    document.getElementById('back-button').onclick = function () {
        location.href = "portal.html";
    }

    // this needs to be changed to fit my form URL and fetching
    async function getFormInfo() {

        const id = localStorage.eID;
        const url = `http://localhost:7000/employees/${id}/forms`;

        const httpResponse = await fetch(url);
        const body = await httpResponse.json();

        console.log(body);

        let count = body.length;

        console.log(count);

        return { body }

    }

    async function populateTable() {

        let forms = await getFormInfo();

        forms = forms.body;

        for (i = 0; i < forms.length; i++) {

            let myTable = document.getElementById("myTable");

            let tableRow = document.createElement("tr");

            // add unique id to table row
            tableRow.id = "myTableRow" + i;

            let eventType = document.createElement("td");
            let dateSubmitted = document.createElement("td");
            let status = document.createElement("td");

            // add appropriate class names to each data entry in row
            eventType.className = "eventType";
            dateSubmitted.className = "dateSubmitted";
            status.className = "status";

            eventType.style.width = "25%";
            dateSubmitted.style.width = "45%";
            status.style.width = "33%";

            let d = new Date(forms[i].dateTimeCompleted*1000);

            console.log(d);


            // add displayed HTML
            eventType.innerHTML = forms[i].event.typeOf;
            dateSubmitted.innerHTML = d;
            status.innerHTML = forms[i].approval.status;

            // myTable.appendChild(tableRow);

            tableRow.appendChild(eventType);
            tableRow.appendChild(dateSubmitted);
            tableRow.appendChild(status);

            myTable.appendChild(tableRow);

        }

    }

</script>

</html>