<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Portal</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link href="/css/style.css" rel="stylesheet">
</head>

<body onload="addApproveButton()">

    <div class="wrapper">
        <div class="container container-color">
            <h2 id="welcome-header" class="container-text">Welcome back!</h2>

            <div>
                <button id="submit-form-button" style="width: 100%;">Submit a New Form</button>
            </div>

            <div>
                <button id="view-forms-button" style="width: 100%;">View Status on Submitted Forms</button>
            </div>

            <div id="approve-btn-div">
                <!-- if a supervisor, add extra button  <button id="approve-form-button" style="width: 100%;">View Forms Pending Your Approval</button> -->

            </div>

            <div>
                <button id="logout-button" style="width: 100%;">Logout</button>
            </div>

            </button>
        </div>

    </div>

</body>

<script>

    document.getElementById("welcome-header").innerHTML = "Welcome back, " + localStorage.firstName + "!";

    document.getElementById('submit-form-button').onclick = function () {
        location.href = "submitForm.html";
    }

    document.getElementById('view-forms-button').onclick = function () {
        location.href = "viewSubmittedForms.html";
    }

    document.getElementById('logout-button').onclick = function () {
        location.href = "index.html";
    }

    function approveClick() {
        location.href = "approveForm.html";
    }

    async function addApproveButton() {

        const url = `http://localhost:7000/supervisoremployees`;

        const httpResponse = await fetch(url);

        const employeeRelationships = await httpResponse.json();

        // console.log(employee);

        console.log(JSON.stringify(employeeRelationships));

        for (const employee in employeeRelationships) {
            if (Object.hasOwnProperty.call(employeeRelationships, employee)) {
                const element = employeeRelationships[employee];
                console.log("element " + element.sID);
                console.log("local " + localStorage.eID);

                // if employee ID of current user is found as a supervisor
                // value in the table employee_supervisor
                if (element.sID == localStorage.eID) {
                    console.log("you are a supervisor!")

                    let myDiv = document.getElementById("approve-btn-div");

                    let btn = document.createElement("button");

                    btn.id = "approve-form-button";
                    btn.innerHTML = "View Forms Pending Your Approval";
                    btn.style.width = "100%";
                    btn.onclick = approveClick;


                    myDiv.appendChild(btn);

                    break;
                }

            }
        }



    }

</script>

</html>